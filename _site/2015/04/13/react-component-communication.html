<!DOCTYPE html>
<html>

<head>
    <title>kellyjandrews</title>
    <link rel='stylesheet' href='/assets/css/styles.css' type='text/css' media='all' />
    <script src="/assets/js/bundle.js"></script>
    <link rel="alternate" type="application/rss+xml" title="kellyjandrews" href="/rss/">
    <link rel="canonical" href="http://kellyjandrews.com/" />
</head>


<body>
  <nav class="navbar navbar-default navbar-fixed-top">
  <div class="container-fluid">
    <div class="row">
    <div class="col-md-6">
      <header class="site-header">
        <h1>
            <a href="/" title="kellyjandrews">kelly j andrews</a>
        </h1>
    </header>
</div>
    <div class="col-md-6 text-right">
      <a href="/experience" class="navlink"><i class="fa fa-info-circle fa-2x"></i></a>
      <a href="https://github.com/kellyjandrews" target="_blank"><i class="fa fa-github fa-2x"></i></a>
      <a href="https://twitter.com/kellyjandrews" target="_blank" ><i class="fa fa-twitter fa-2x"></i></a>
      <a href="https://www.linkedin.com/in/kjandrews/en" target="_blank" ><i class="fa fa-linkedin fa-2x"></i></a>
      <a href="https://stackexchange.com/users/2222625/kelly-j-andrews" target="_blank"><i class="fa fa-stack-exchange fa-2x"></i></a>
  </div>
  </div>
  </div>
</nav>


    <div class="container-fluid">
        <div class="padded">
	<div class="col-md-8 col-md-offset-2">
  <h1>React Component Communication</h1>
<h2 id="the-real-work-starts">The Real Work Starts</h2>
<p>So far in the series, we have mocked up the <code class="highlighter-rouge">DataGrid</code> component, set up our application workflow with <a href="http://gulpjs.com/">Gulp</a> and <a href="https://babeljs.io/">Babel</a>, and updated our <code class="highlighter-rouge">DataTable</code> component to use some example data. At this point, <code class="highlighter-rouge">DataGrid</code> is still a fairly static component.  So let’s look at how to make the <code class="highlighter-rouge">Pagination</code> and <code class="highlighter-rouge">DataTable</code> work together and communicate through the <code class="highlighter-rouge">DataGrid</code>.</p>

<h2 id="caution">Caution</h2>
<p>This tutorial is not for the faint hearted.  I will do my best to explain everything that is going on and break it down into simple chunks. It’s also using pure React and JavaScript when possible. There are libraries that can help with some of the data flow challenges that are faced doing this kind of component, however, with any framework, understanding how it works at it’s lowest level is highly beneficial when you begin abstracting layers with additional libraries.</p>

<h2 id="ownerownee-and-data">Owner/Ownee and Data</h2>
<p>React specifically makes the distinction between owner/ownee and parent/child relationships. A component is an owner, and any sub components are ownees. This is differs from parent/child, where a tag wraps inner tags. I will use this as the terminology henceforth.  Forgive me if I used these interchangeably in the past.</p>

<p>With this in mind, we then can make decisions about which component owns what data. Looking at the <code class="highlighter-rouge">DataGrid</code> component, there are a few data points to keep track of:</p>

<ol>
  <li><strong>Item Counts:</strong> Based on our mockup, we want to track the starting and ending item number, and the total count</li>
  <li><strong>Display Count Setting:</strong> The UI allows for a user to set the maximum number of items displayed at one time.</li>
  <li><strong>Current Page:</strong> The user will be paging through results, and we want to track what page the user is currently on.</li>
  <li><strong>Data Set:</strong> We will need to manage somehow what data gets rendered in the <code class="highlighter-rouge">DataTable</code>.</li>
</ol>

<p>The goal is to manage these data points in the top-level, and then pass them down through the components.  Let’s start with an initial change, that will get the data flow moving first.</p>

<h2 id="initial-changes">Initial Changes</h2>
<p>The first step is to get the data to the top level from the two dropdowns for display count and current page. Since we are building components, it made sense to add a new component named <code class="highlighter-rouge">DropDownMenu</code> and render it in the <code class="highlighter-rouge">Pagination</code> component.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="cm">/* pagination.jsx */</span>
<span class="kr">class</span> <span class="nx">DropDownMenu</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">optionList</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">option</span><span class="p">,</span> <span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">(</span>
        <span class="o">&lt;</span><span class="nx">li</span> <span class="nx">key</span><span class="o">=</span><span class="p">{</span><span class="nx">key</span><span class="p">}</span><span class="o">&gt;&lt;</span><span class="nx">a</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">option</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/a&gt;&lt;/</span><span class="nx">li</span><span class="o">&gt;</span>
      <span class="p">)</span>
    <span class="p">},</span> <span class="k">this</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span>
      <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s2">"btn-group"</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">type</span><span class="o">=</span><span class="s2">"button"</span> <span class="nx">className</span><span class="o">=</span><span class="s2">"btn btn-xs btn-default dropdown-toggle"</span> <span class="nx">data</span><span class="o">-</span><span class="nx">toggle</span><span class="o">=</span><span class="s2">"dropdown"</span><span class="o">&gt;</span>
          <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">value</span><span class="p">}</span> <span class="o">&lt;</span><span class="nx">span</span> <span class="nx">className</span><span class="o">=</span><span class="s2">"caret"</span><span class="o">&gt;&lt;</span><span class="sr">/span</span><span class="err">&gt;
</span>        <span class="o">&lt;</span><span class="sr">/button</span><span class="err">&gt;
</span>        <span class="o">&lt;</span><span class="nx">ul</span> <span class="nx">className</span><span class="o">=</span><span class="s2">"dropdown-menu"</span> <span class="nx">role</span><span class="o">=</span><span class="s2">"menu"</span><span class="o">&gt;</span>
          <span class="p">{</span><span class="nx">optionList</span><span class="p">}</span>
        <span class="o">&lt;</span><span class="sr">/ul</span><span class="err">&gt;
</span>      <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span>
</code></pre>
</div>

<p>If you read the previous post in the series, this should look somewhat familiar. The <code class="highlighter-rouge">DropDownMenu</code> controller will need some options passed to it as an array, and then we map the array to out put our <code class="highlighter-rouge">&lt;li&gt;</code>s to be rendered to the UI, and the current value that is set.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;DropDownMenu</span> <span class="na">value=</span><span class="s">"Current Value"</span> <span class="na">options=</span><span class="s">["Current</span> <span class="na">Value</span><span class="err">",</span> <span class="err">"</span><span class="na">Another</span> <span class="na">Value</span><span class="err">"]</span> <span class="nt">/&gt;</span>
</code></pre>
</div>

<p>So far, we are only using the <code class="highlighter-rouge">render()</code> method. We need to add some handler to the <code class="highlighter-rouge">&lt;a&gt;</code> tag to pass back what has been selected.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="cm">/* pagination.jsx */</span>
<span class="kr">class</span> <span class="nx">DropDownMenu</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="nx">handleClick</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">onChange</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">options</span><span class="p">[</span><span class="nx">key</span><span class="p">]);</span>
  <span class="p">}</span>
  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">optionList</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">option</span><span class="p">,</span> <span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">(</span>
        <span class="o">&lt;</span><span class="nx">li</span> <span class="nx">key</span><span class="o">=</span><span class="p">{</span><span class="nx">key</span><span class="p">}</span><span class="o">&gt;&lt;</span><span class="nx">a</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">handleClick</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">key</span><span class="p">)}</span> <span class="o">&gt;</span><span class="p">{</span><span class="nx">option</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/a&gt;&lt;/</span><span class="nx">li</span><span class="o">&gt;</span>
      <span class="p">)</span>
    <span class="p">},</span> <span class="k">this</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(...</span>
</code></pre>
</div>

<p>Adding a <code class="highlighter-rouge">handleClick()</code> method to the class, we now have the ability to capture which option was selected, and then do something with that information. We grab where the click took place by adding <code class="highlighter-rouge">onClick={this.handleClick.bind(this, key)</code> to each anchor tag.  <code class="highlighter-rouge">This</code> for each option in the drop down represents the current <code class="highlighter-rouge">DropDownMenu</code> component, and finds the option by it’s <code class="highlighter-rouge">key</code> and logs the option to the console. The final <code class="highlighter-rouge">}, this)</code> binds the class to the map function to make it aware of the current class methods.</p>

<p>Notice we are now using an <code class="highlighter-rouge">onChange</code> function from <code class="highlighter-rouge">props</code>. This is a simple way to pass information back to <code class="highlighter-rouge">Pagination</code>, so it is also aware of the change. I’ll get to that in detail in just a bit.</p>

<p>For now, modify how these are called in <code class="highlighter-rouge">Pagination</code>:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>...
<span class="nt">&lt;DropDownMenu</span> <span class="na">value=</span><span class="s">{1}</span> <span class="na">options=</span><span class="s">{[1,2,3,4,5,6,7,8,9,10]}</span> <span class="nt">/&gt;</span>
...
<span class="nt">&lt;DropDownMenu</span> <span class="na">value=</span><span class="s">{10}</span> <span class="na">options=</span><span class="s">{[10,25]}</span> <span class="nt">/&gt;</span>
...
</code></pre>
</div>

<p>I’m actually going to pass <code class="highlighter-rouge">props</code> later for the value and options, but for now this can be static. If you run the app now, you will get an error since we haven’t passed in <code class="highlighter-rouge">onChange()</code> from the owner component. Let’s do that now.</p>

<h2 id="pagination">Pagination</h2>
<p>Remember how I said that our goal is to manage data at the top level? <code class="highlighter-rouge">DropDownMenu</code> currently provides a path for <code class="highlighter-rouge">Pagination</code> to learn of the changes, but if we stick to the goal of top down data flow, <code class="highlighter-rouge">Pagination</code> also needs a way to communicate with it’s owner, <code class="highlighter-rouge">DataGrid</code>.</p>

<p>Much like <code class="highlighter-rouge">DropDownMenu</code>, <code class="highlighter-rouge">Pagination</code> doesn’t need to do much more than report changes to <code class="highlighter-rouge">DataGrid</code>. Data will flow from the top down, and <code class="highlighter-rouge">Pagination</code> will update based on new data.</p>

<p>First, let’s take a look at the way we handle the selections bubbled up from the <code class="highlighter-rouge">DropDownMenu</code>.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="cm">/* pagination.jsx */</span>
<span class="p">...</span>
<span class="nx">updateSettings</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">setting</span> <span class="o">=</span> <span class="p">{};</span>
  <span class="nx">setting</span><span class="p">[</span><span class="nx">type</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">onChange</span><span class="p">(</span><span class="nx">setting</span><span class="p">);</span>
<span class="p">}</span>

<span class="p">...</span>

<span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s2">"well"</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s2">"row"</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s2">"col-md-6"</span><span class="o">&gt;</span>
          <span class="o">&lt;</span><span class="nx">strong</span><span class="o">&gt;</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">itemStart</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/strong&gt; - &lt;strong&gt;{this.props.itemEnd}&lt;/</span><span class="nx">strong</span><span class="o">&gt;</span> <span class="nx">items</span> <span class="nx">out</span> <span class="nx">of</span> <span class="o">&lt;</span><span class="nx">strong</span><span class="o">&gt;</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">count</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/strong</span><span class="err">&gt;
</span>        <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>        <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s2">"col-md-6"</span><span class="o">&gt;</span>
          <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s2">"pageControls pull-right"</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">className</span><span class="o">=</span><span class="s2">"btn btn-xs btn-default glyphicon glyphicon-triangle-left"</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">updateSettings</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="s2">"page"</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">page</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)}</span> <span class="nx">disabled</span><span class="o">=</span><span class="p">{</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">prev</span><span class="p">}</span> <span class="sr">/</span><span class="err">&gt;
</span>            <span class="o">&lt;</span><span class="nx">DropDownMenu</span> <span class="nx">value</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">page</span><span class="p">}</span> <span class="nx">options</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">pageOptions</span><span class="p">}</span> <span class="nx">ref</span><span class="o">=</span><span class="s2">"page"</span> <span class="nx">onChange</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">updateSettings</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s2">"page"</span><span class="p">)}</span> <span class="sr">/</span><span class="err">&gt;
</span>            <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">className</span><span class="o">=</span><span class="s2">"btn btn-xs btn-default glyphicon glyphicon-triangle-right"</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">updateSettings</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="s2">"page"</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">page</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)}</span> <span class="nx">disabled</span><span class="o">=</span><span class="p">{</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">next</span><span class="p">}</span> <span class="sr">/</span><span class="err">&gt;
</span>          <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>          <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s2">"itemOption pull-right"</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="nx">DropDownMenu</span> <span class="nx">value</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">displayCount</span><span class="p">}</span> <span class="nx">options</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">displayCountOptions</span><span class="p">}</span> <span class="nx">ref</span><span class="o">=</span><span class="s2">"displayCount"</span> <span class="nx">onChange</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">updateSettings</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s2">"displayCount"</span><span class="p">)}</span> <span class="sr">/</span><span class="err">&gt;
</span>          <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>        <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>        <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s2">"clearfix"</span><span class="o">&gt;&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>        <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>    <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>  <span class="p">);</span>
<span class="p">}</span>
<span class="p">};</span>

</code></pre>
</div>

<p>This looks like a lot, but there actually isn’t too much happening here. <code class="highlighter-rouge">DataGrid</code> will be sending down the <code class="highlighter-rouge">page</code> and <code class="highlighter-rouge">displayCount</code> as props. While using the <code class="highlighter-rouge">state</code> could also make sense, there are some considerations when these change that I want to handle at the top level and pass to multiple components. If I maintain state in <code class="highlighter-rouge">Pagination</code>, I end up breaking the top down approach and introduce code in places that doesn’t make sense.</p>

<p>I’ve added the <code class="highlighter-rouge">updateSetting()</code> method to the class to pass to the <code class="highlighter-rouge">onChange</code> property of <code class="highlighter-rouge">DropDownMenu</code>. When <code class="highlighter-rouge">DropDownMenu</code> fires the <code class="highlighter-rouge">handleClick()</code> method, <code class="highlighter-rouge">updateSettings()</code> calls a similar <code class="highlighter-rouge">onChange()</code> method passed in from <code class="highlighter-rouge">DataGrid</code> as a property.</p>

<p><code class="highlighter-rouge">updateSettings()</code> takes two parameters, <code class="highlighter-rouge">type</code> and <code class="highlighter-rouge">value</code>.  Using <code class="highlighter-rouge">bind()</code>, I add <code class="highlighter-rouge">this</code> for proper context, and send additional arguments to the method - which is just vanilla JS. On the two buttons, I manually send the <code class="highlighter-rouge">value</code> param, however, with the <code class="highlighter-rouge">DropDownMenu</code>, <code class="highlighter-rouge">value</code> comes from the <code class="highlighter-rouge">handleClick()</code> method in <code class="highlighter-rouge">DropDownMenu</code>.</p>

<p>There are two types that are being passed back to <code class="highlighter-rouge">DataGrid</code> - “page” and “displayCount”.  Remember how I mentioned that is all the pagination does?  It’s simply reporting back to it’s owner what options have been selected.</p>

<p>There are, however, two items we want to track in <code class="highlighter-rouge">state</code> - the next/previous button states.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="cm">/* pagination.jsx */</span>
<span class="kr">class</span> <span class="nx">Pagination</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span><span class="p">{</span>
  <span class="nx">constructor</span><span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">super</span><span class="p">(</span><span class="nx">props</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">buttonStates</span><span class="p">(</span><span class="nx">props</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">componentWillReceiveProps</span><span class="p">(</span><span class="nx">nextProps</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">buttonStates</span><span class="p">(</span><span class="nx">nextProps</span><span class="p">));</span>
  <span class="p">}</span>

  <span class="nx">buttonStates</span><span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">buttonStates</span> <span class="o">=</span> <span class="p">{</span><span class="na">prev</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="na">next</span><span class="p">:</span> <span class="kc">true</span><span class="p">};</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">props</span><span class="p">.</span><span class="nx">page</span> <span class="o">===</span> <span class="nx">props</span><span class="p">.</span><span class="nx">pageOptions</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">{</span>
      <span class="nx">buttonStates</span><span class="p">.</span><span class="nx">prev</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">props</span><span class="p">.</span><span class="nx">page</span> <span class="o">===</span> <span class="nx">props</span><span class="p">.</span><span class="nx">pageOptions</span><span class="p">[</span><span class="nx">props</span><span class="p">.</span><span class="nx">pageOptions</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span> <span class="p">{</span>
      <span class="nx">buttonStates</span><span class="p">.</span><span class="nx">next</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">buttonStates</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">...</span>
</code></pre>
</div>

<p>I created a function <code class="highlighter-rouge">buttonStates()</code> to manage the next/previous buttons.  This just checks the current page, and determines if it’s first or last in the array of <code class="highlighter-rouge">pageOptions</code>. The buttons then have <code class="highlighter-rouge">disabled={!this.state.next}</code> and <code class="highlighter-rouge">disabled={!this.state.prev}</code> to turn them on and off accordingly.</p>

<p>ES6 slightly changes the way <code class="highlighter-rouge">state</code> is created - directly in the <code class="highlighter-rouge">constructor()</code> method, as opposed to <code class="highlighter-rouge">getInitialState()</code>. From here, I call the <code class="highlighter-rouge">buttonStates()</code> method and return the initial object. When the <code class="highlighter-rouge">DataGrid</code> sends new <code class="highlighter-rouge">props</code> down, we then use the <a href="https://facebook.github.io/react/docs/component-specs.html">React lifecycle method</a> <code class="highlighter-rouge">componentWillReceiveProps()</code> to update our <code class="highlighter-rouge">state</code>.</p>

<p>That’s it - this is all we need the <code class="highlighter-rouge">Pagination</code> component to do. What we have so far, is a component that passes data back to it’s owner when it’s changed (twice actually), and it maintains it’s own state for buttons.</p>

<h2 id="driving-with-the-top-down">Driving With The Top Down</h2>
<p>Since we created <code class="highlighter-rouge">Pagination</code> to operate with very little functionality - <code class="highlighter-rouge">DataGrid</code> needs to pass down the right <code class="highlighter-rouge">props</code> to keep things accurate. <code class="highlighter-rouge">Pagination</code> needs several data points from <code class="highlighter-rouge">DataGrid</code>:
<code class="highlighter-rouge">html
&lt;Pagination
  count={this.state.count}
  page={this.state.page}
  displayCount={this.state.displayCount}
  itemStart = {this.state.itemStart}
  itemEnd = {this.state.itemEnd}
  pageOptions = {this.state.pageOptions}
  displayCountOptions = {this.props.displayCountOptions}
  onChange={this.handlePagination}
/&gt;
</code></p>

<p>Let’s walk through this before moving on. The <code class="highlighter-rouge">Pagination</code> render method is looking for several items, and those all are passed as props.  <code class="highlighter-rouge">DataGrid</code> will manage everything in <code class="highlighter-rouge">state</code> that is allowed to change. Notice two items are not <code class="highlighter-rouge">state</code> properties?  <code class="highlighter-rouge">displayCountOptions</code> in reality should never change - I’ve set mine to 10 and 25. I can’t think of a good reason for the UI to change those options in the drop down, so I just left them as <code class="highlighter-rouge">props</code>. Also, I introduce the <code class="highlighter-rouge">onChange()</code> property that takes a function, and eventually is called by <code class="highlighter-rouge">updateSettings()</code> in the <code class="highlighter-rouge">Pagination</code> component. Now it all starts to come together.</p>

<h3 id="constructing-datagrid">Constructing DataGrid</h3>
<p>When I build the initial <code class="highlighter-rouge">DataGrid</code> there are a few steps I want to perform right away.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="cm">/* app.jsx */</span>

<span class="kr">class</span> <span class="nx">DataGrid</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span><span class="p">{</span>
  <span class="nx">constructor</span><span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">super</span><span class="p">(</span><span class="nx">props</span><span class="p">);</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">handlePagination</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">handlePagination</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">paginateData</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">paginateData</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">getStartEnd</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getStartEnd</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>

    <span class="kd">var</span> <span class="nx">startEnd</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getStartEnd</span><span class="p">(</span><span class="nx">props</span><span class="p">);</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">count</span><span class="p">:</span> <span class="nx">props</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span>
      <span class="na">data</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">paginateData</span><span class="p">(</span><span class="nx">startEnd</span><span class="p">.</span><span class="nx">itemStart</span><span class="p">,</span> <span class="nx">startEnd</span><span class="p">.</span><span class="nx">itemEnd</span><span class="p">),</span>
      <span class="na">displayCount</span><span class="p">:</span> <span class="nx">props</span><span class="p">.</span><span class="nx">displayCount</span><span class="p">,</span>
      <span class="na">itemStart</span><span class="p">:</span> <span class="nx">startEnd</span><span class="p">.</span><span class="nx">itemStart</span><span class="p">,</span>
      <span class="na">itemEnd</span><span class="p">:</span> <span class="nx">startEnd</span><span class="p">.</span><span class="nx">itemEnd</span><span class="p">,</span>
      <span class="na">page</span><span class="p">:</span> <span class="nx">props</span><span class="p">.</span><span class="nx">page</span><span class="p">,</span>
      <span class="na">pageOptions</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">getPageOptions</span><span class="p">(</span><span class="nx">props</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span> <span class="nx">props</span><span class="p">.</span><span class="nx">displayCount</span><span class="p">)</span>
    <span class="p">};</span>
  <span class="p">}</span>

  <span class="nx">handlePagination</span><span class="p">(</span><span class="nx">setting</span><span class="p">)</span> <span class="p">{...}</span>
  <span class="nx">getStartEnd</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="p">{...}</span>
  <span class="nx">getPageOptions</span><span class="p">(</span><span class="nx">count</span><span class="p">,</span> <span class="nx">displayCount</span><span class="p">)</span> <span class="p">{...}</span>
  <span class="nx">paginateData</span><span class="p">(</span><span class="nx">start</span><span class="p">,</span> <span class="nx">end</span><span class="p">)</span> <span class="p">{...}</span>

  <span class="nx">render</span><span class="p">()</span> <span class="p">{...}</span>
<span class="p">};</span>

</code></pre>
</div>

<p>In ES6, we need to bind all class functions to <code class="highlighter-rouge">this</code> - <code class="highlighter-rouge">this.handlePagination = this.handlePagination.bind(this);</code>, etc. Doing this allows each method access to the current instance of <code class="highlighter-rouge">DataGrid</code>.</p>

<p>You might be wondering why I have <code class="highlighter-rouge">this.props.data</code> and <code class="highlighter-rouge">this.state.data</code>. The reason for this is I want <code class="highlighter-rouge">this.props.data</code> to be immutable. When we page the data, we aren’t actually changing the data, just returning a subset of data to the <code class="highlighter-rouge">DataTable</code> component - in my case either 10 or 25 rows at a time.</p>

<h2 id="class-helper-functions">Class Helper Functions</h2>
<p>There are three functions in our <code class="highlighter-rouge">DataGrid</code> component that simply return some result:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="cm">/* app.jsx */</span>
<span class="p">...</span>
<span class="nx">getStartEnd</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">highestItem</span> <span class="o">=</span> <span class="nx">state</span><span class="p">.</span><span class="nx">page</span> <span class="o">*</span> <span class="nx">state</span><span class="p">.</span><span class="nx">displayCount</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="p">{};</span>
  <span class="nx">result</span><span class="p">.</span><span class="nx">itemStart</span> <span class="o">=</span> <span class="p">((</span><span class="nx">state</span><span class="p">.</span><span class="nx">page</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="nx">state</span><span class="p">.</span><span class="nx">displayCount</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
  <span class="nx">result</span><span class="p">.</span><span class="nx">itemEnd</span> <span class="o">=</span> <span class="p">(</span><span class="nx">highestItem</span> <span class="o">&lt;=</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">?</span> <span class="nx">highestItem</span> <span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
  <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">getPageOptions</span><span class="p">(</span><span class="nx">count</span><span class="p">,</span> <span class="nx">displayCount</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">options</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Array</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">ceil</span><span class="p">(</span><span class="nx">count</span> <span class="o">/</span> <span class="nx">displayCount</span><span class="p">));</span>
  <span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
  <span class="k">while</span><span class="p">(</span><span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">a</span><span class="p">){</span>
    <span class="nx">options</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
    <span class="nx">i</span><span class="o">++</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">options</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">paginateData</span><span class="p">(</span><span class="nx">start</span><span class="p">,</span> <span class="nx">end</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">start</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">end</span><span class="p">);</span>
<span class="p">}</span>
<span class="p">...</span>
</code></pre>
</div>

<p>These three functions are just class helpers - they run when called, do not set state, and return a result. Basically, helper functions to reduce redundancy. We could create <code class="highlighter-rouge">static</code> methods, which makes those functions externally available, allowing them to run prior to creating a component instance, and they don’t have access to <code class="highlighter-rouge">state</code> or <code class="highlighter-rouge">props</code>.  This really isn’t what we need here, so they remain class helper methods.</p>

<p>These methods are really simple in function.</p>

<ul>
  <li><code class="highlighter-rouge">getStartEnd()</code> provides a way to ensure the start and end item number match up the current data set displayed.</li>
  <li><code class="highlighter-rouge">getPageOptions()</code> creates the array for the <code class="highlighter-rouge">DropDownMenu</code> component, since the number of pages changes when you change the display count.</li>
  <li><code class="highlighter-rouge">paginateData()</code> returns my data set sliced by the page.</li>
</ul>

<h3 id="handling-the-pagination-changes">Handling The Pagination Changes</h3>
<p>All that’s left to do it handle the pagination. <code class="highlighter-rouge">handlePagination()</code> runs when the <code class="highlighter-rouge">Pagination</code> component fires <code class="highlighter-rouge">this.props.onChange</code>.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="cm">/* app.jsx */</span>
<span class="p">...</span>
<span class="nx">handlePagination</span><span class="p">(</span><span class="nx">setting</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">nextState</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">assign</span><span class="p">({},</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">,</span> <span class="nx">setting</span><span class="p">);</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">nextState</span><span class="p">.</span><span class="nx">displayCount</span> <span class="o">!=</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">displayCount</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">nextState</span><span class="p">.</span><span class="nx">pageOptions</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getPageOptions</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span> <span class="nx">nextState</span><span class="p">.</span><span class="nx">displayCount</span><span class="p">);</span>

    <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="nx">nextState</span><span class="p">.</span><span class="nx">pageOptions</span><span class="p">.</span><span class="nx">every</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">option</span><span class="p">){</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">that</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">itemStart</span> <span class="o">&lt;</span> <span class="nx">option</span> <span class="o">*</span> <span class="nx">nextState</span><span class="p">.</span><span class="nx">displayCount</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">nextState</span><span class="p">.</span><span class="nx">page</span> <span class="o">=</span> <span class="nx">option</span><span class="p">;</span>
        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="p">}</span>

  <span class="nx">nextState</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">assign</span><span class="p">(</span><span class="nx">nextState</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">getStartEnd</span><span class="p">(</span><span class="nx">nextState</span><span class="p">));</span>
  <span class="nx">nextState</span><span class="p">.</span><span class="nx">data</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">paginateData</span><span class="p">(</span><span class="nx">nextState</span><span class="p">.</span><span class="nx">itemStart</span><span class="p">,</span> <span class="nx">nextState</span><span class="p">.</span><span class="nx">itemEnd</span><span class="p">);</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">(</span><span class="nx">nextState</span><span class="p">);</span>
<span class="p">}</span>
<span class="p">...</span>
</code></pre>
</div>

<p><code class="highlighter-rouge">Pagination</code> sends an object back, <code class="highlighter-rouge"><span class="p">{</span><span class="err">type:value</span><span class="p">}</span></code> based on what is changed, either <code class="highlighter-rouge">displayCount</code> or <code class="highlighter-rouge">page</code>. At this point, I felt it necessary to include <a href="https://lodash.com/"><code class="highlighter-rouge">lodash</code></a> for the <code class="highlighter-rouge">assign()</code> method.</p>

<p><code class="highlighter-rouge">handlePagination()</code> does just a few simple steps.  I use <code class="highlighter-rouge">nextState</code> here to manually build out the changes and pass to the other helper functions.  The most important part here is checking for <code class="highlighter-rouge">displayCount</code> changes.  Since changing how many items display will change the current <code class="highlighter-rouge">page</code>, I want to be sure to handle that properly. I took the approach of keeping the user as close to the original data set they were previously viewing, so I’m changing the page they are on based on the <code class="highlighter-rouge">itemStart</code> property. Not sure if I like it, but it works for now.</p>

<p>Finally, I update the final items in <code class="highlighter-rouge">state</code> and then using <code class="highlighter-rouge">setState()</code> method update the component. All of the <code class="highlighter-rouge">DataGrid</code> ownees then get updated with the new data automatically.</p>

<h2 id="defaults">Defaults</h2>
<p>When you initialize the <code class="highlighter-rouge">DataGrid</code>, you can actually pass in additional <code class="highlighter-rouge">props</code>. <code class="highlighter-rouge">DataGrid</code> relies on <code class="highlighter-rouge">displayCount</code>, <code class="highlighter-rouge">displayCountOptions</code> array, <code class="highlighter-rouge">page</code>, and <code class="highlighter-rouge">data</code>. This will allow the owner of <code class="highlighter-rouge">DataGrid</code> to pass in specific details to render, say the user leaves the containing page and comes back - you might store where they left off and return them to the exact spot.</p>

<p>However, these aren’t required, and I handle that using <code class="highlighter-rouge">defaultProps</code> on the component class.
<code class="highlighter-rouge">js
DataGrid.defaultProps = {
  displayCount: 10,
  page: 1,
  displayCountOptions : [10,25],
}
</code></p>

<p>Now, our <code class="highlighter-rouge">DataGrid</code> only requires <code class="highlighter-rouge">data</code> to be passed in, and everything else has a default.</p>

<h2 id="wrap-up">Wrap Up</h2>
<p>Phew! This took me a bit to get here. To be honest, I started with a much larger code set and did some rework, and I’m happy with where it’s ended up. The process helped me really digest how top down data should be approached, and separating concerns as much as possible. There were a lot of change to get here, but in reality - it’s very simple.  When the <code class="highlighter-rouge">DropDownMenu</code> changes, the <code class="highlighter-rouge">DataGrid</code> is alerted and send the data back through. It updates the UI super quick, and feels very natural.</p>

<p>There is still some additional functionality I’d like to introduce, but so far this is very operational. Next steps are adding the search function to reduce the number of total results.</p>

<p>I’ve updated my <a href="https://github.com/kellyjandrews/react-tutorial/tree/pagination">GitHub repo</a> with the source code from this tutorial.</p>



  <h4>React Data Grid Tutorials</h4>
  <ol>
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      
      <li><a href="/2015/03/30/react-up-and-running.html" title="React - Up and Running">React - Up and Running</a></li>
      
    
  
    
      
      <li><a href="/2015/04/01/modular-react-components-with-browserify.html" title="Modular React Components With Browserify">Modular React Components With Browserify</a></li>
      
    
  
    
      
      <li><a href="/2015/04/08/data-driven-react-components.html" title="Data Driven React Components">Data Driven React Components</a></li>
      
    
  
    
  
    
      
      <li class="active">React Component Communication</li>
      
    
  
    
      
      <li><a href="/2015/04/20/refactoring-react-data-grid.html" title="Refactoring React Data Grid">Refactoring React Data Grid</a></li>
      
    
  
    
      
      <li><a href="/2015/04/21/data-filtering-for-react.html" title="Data Filtering for React">Data Filtering for React</a></li>
      
    
  
  </ol>



<div id="disqus_thread"></div>
   <script type="text/javascript">
       /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
       var disqus_shortname = 'kellyjandrews'; // required: replace example with your forum shortname
       var disqus_title = "React Component Communication";
       /* * * DON'T EDIT BELOW THIS LINE * * */
       (function() {
           var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
           dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
           (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
       })();
   </script>
   <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

</div>

</div>

    </div>

    <footer class="text-center">
    <small>All content copyright <a href="/">kelly j andrews</a> &copy; 2016 &bull; All rights reserved.</small>
    </a>
</footer>

    <script>
    (function(i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r;
        i[r] = i[r] || function() {
            (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date();
        a = s.createElement(o),
            m = s.getElementsByTagName(o)[0];
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

    ga('create', 'UA-47461674-1', 'kellyjandrews.com');
    ga('send', 'pageview');
</script>
</body>

</html>
