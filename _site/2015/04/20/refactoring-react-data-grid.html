<!DOCTYPE html>
<html>

<head>
    <title>kellyjandrews</title>
    <link rel='stylesheet' href='/assets/css/styles.css' type='text/css' media='all' />
    <script src="/assets/js/bundle.js"></script>
    <link rel="alternate" type="application/rss+xml" title="kellyjandrews" href="/rss/">
    <link rel="canonical" href="http://kellyjandrews.com/" />
</head>


<body>
  <nav class="navbar navbar-default navbar-fixed-top">
  <div class="container-fluid">
    <div class="row">
    <div class="col-md-6">
      <header class="site-header">
        <h1>
            <a href="/" title="kellyjandrews">kelly j andrews</a>
        </h1>
    </header>
</div>
    <div class="col-md-6 text-right">
      <a href="/experience" class="navlink"><i class="fa fa-info-circle fa-2x"></i></a>
      <a href="https://github.com/kellyjandrews" target="_blank"><i class="fa fa-github fa-2x"></i></a>
      <a href="https://twitter.com/kellyjandrews" target="_blank" ><i class="fa fa-twitter fa-2x"></i></a>
      <a href="https://www.linkedin.com/in/kjandrews/en" target="_blank" ><i class="fa fa-linkedin fa-2x"></i></a>
      <a href="https://stackexchange.com/users/2222625/kelly-j-andrews" target="_blank"><i class="fa fa-stack-exchange fa-2x"></i></a>
  </div>
  </div>
  </div>
</nav>


    <div class="container-fluid">
        <div class="padded">
	<div class="col-md-8 col-md-offset-2">
  <h1>Refactoring React Data Grid</h1>
<h2 id="self-correction">Self Correction</h2>
<p>I spent the last few days really thinking about the <code class="highlighter-rouge">DataGrid</code> and how to utilize <a href="https://facebook.github.io/react/">React</a> in the best way possible. <code class="highlighter-rouge">DataGrid</code> currently works, but if we evaluate individual components, I haven’t adhered to keeping these modular and reusable.</p>

<p>Every project, at some point, has to be evaluated and adjusted - so I took the time now to walk through my thought process.</p>

<h3 id="why-now">Why Now?</h3>
<p>As I started to implement the search functionality, a few items are glaring issues that needed to be addressed:</p>

<ol>
  <li><code class="highlighter-rouge">DataGrid</code> state object is simply doing too much. Storing data that will change is proper, however it is also storing computed values - which is completely uneccessary - as well as I started to duplicate some <code class="highlighter-rouge">state</code> to make things work.</li>
  <li><code class="highlighter-rouge">TitleBar</code> just doesn’t make sense. The real component here is <code class="highlighter-rouge">SearchBox</code>, and the markup in <code class="highlighter-rouge">TitleBar</code> can be move up to <code class="highlighter-rouge">DataGrid</code>.  This also allows us to use <code class="highlighter-rouge">SearchBox</code> elsewhere.</li>
  <li>Components are currently unusable outside of <code class="highlighter-rouge">DataGrid</code>. If I want to reuse the <code class="highlighter-rouge">SearchBox</code> or <code class="highlighter-rouge">Pagination</code> for any other components, I would have to recode several lines, which is unproductive and prone to error. I have to move functionality to the right component, without breaking the top-down data flow.</li>
  <li><code class="highlighter-rouge">Pagination</code> requires too many properties, and can be greatly simplified.</li>
  <li>I’m not taking full advantage of vanilla JavaScript here, and can reduce extra code in several spots to simplify debugging.</li>
  <li>Not refactoring would cause additional work later, so better to do this now than continue adding complexity.</li>
</ol>

<p>Maybe you have already spotted some of these issues?  If so, good for you! During the coding process it’s easy to miss optimization opportunities or learn new ways to do things that change the way you think about your project.</p>

<p>In this case, I initially wanted the lower level component to do very little functionality. IF I were simply distributing the data grid as a pre built component, it works. However, after the refactor, I am able to reuse components with less duplicate code.</p>

<h2 id="state-of-the-state">State Of The State</h2>
<p>Currently the <code class="highlighter-rouge">state</code> for the <code class="highlighter-rouge">DataGrid</code> component looks like this:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="cm">/* app.jsx */</span>

<span class="k">this</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">count</span><span class="p">:</span> <span class="nx">props</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span>
  <span class="na">data</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">paginateData</span><span class="p">(</span><span class="nx">startEnd</span><span class="p">.</span><span class="nx">itemStart</span><span class="p">,</span> <span class="nx">startEnd</span><span class="p">.</span><span class="nx">itemEnd</span><span class="p">),</span>
  <span class="na">displayCount</span><span class="p">:</span> <span class="nx">props</span><span class="p">.</span><span class="nx">displayCount</span><span class="p">,</span>
  <span class="na">itemStart</span><span class="p">:</span> <span class="nx">startEnd</span><span class="p">.</span><span class="nx">itemStart</span><span class="p">,</span>
  <span class="na">itemEnd</span><span class="p">:</span> <span class="nx">startEnd</span><span class="p">.</span><span class="nx">itemEnd</span><span class="p">,</span>
  <span class="na">page</span><span class="p">:</span> <span class="nx">props</span><span class="p">.</span><span class="nx">page</span><span class="p">,</span>
  <span class="na">pageOptions</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">getPageOptions</span><span class="p">(</span><span class="nx">props</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span> <span class="nx">props</span><span class="p">.</span><span class="nx">displayCount</span><span class="p">)</span>
<span class="p">};</span>
</code></pre>
</div>

<p>After giving these a hard look, several of these are just computed values - <code class="highlighter-rouge">count</code>, <code class="highlighter-rouge">pageOptions</code>, <code class="highlighter-rouge">itemStart</code> and <code class="highlighter-rouge">itemEnd</code> really should all be controlled at the time of render, and not stored in <code class="highlighter-rouge">state</code>. Each of these are based on <code class="highlighter-rouge">data</code>, <code class="highlighter-rouge">page</code>, and <code class="highlighter-rouge">displayCount</code>.</p>

<p>If we dig a bit deeper, though, even <code class="highlighter-rouge">data</code> is computed. The <code class="highlighter-rouge">prop</code> data is immutable - so it never changes. The <code class="highlighter-rouge">state</code> data is our paginated data set. It’s just a sliced array. If we remove the computed items, our state now looks like this:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="cm">/* app.jsx */</span>

<span class="k">this</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">page</span><span class="p">:</span> <span class="nx">props</span><span class="p">.</span><span class="nx">page</span><span class="p">,</span>
  <span class="na">displayCount</span><span class="p">:</span> <span class="nx">props</span><span class="p">.</span><span class="nx">displayCount</span><span class="p">,</span>
  <span class="na">searchTerm</span><span class="p">:</span> <span class="nx">props</span><span class="p">.</span><span class="nx">searchTerm</span>
<span class="p">};</span>
</code></pre>
</div>

<p>This feels so much cleaner. <code class="highlighter-rouge">searchTerm</code> will come into play later when we get to the search component.</p>

<p><code class="highlighter-rouge">DataGrid</code> also has several class methods doing many different calculations for the <code class="highlighter-rouge">Pagination</code> component. <code class="highlighter-rouge">getStartEnd()</code>, <code class="highlighter-rouge">getPageOptions()</code>, and <code class="highlighter-rouge">paginateData()</code> methods all update the older state version. They also feel like they go together - sort of as a class.</p>

<h3 id="replacing-the-old-guard">Replacing The Old Guard</h3>
<p>Since we basically killed our entire <code class="highlighter-rouge">state</code>, we need a place to get it.  Remember how I mentioned at time of <code class="highlighter-rouge">render()</code>?  Initially, I wanted a function to just build out everything. I ran into some difficulties trying to figure out how, though. <code class="highlighter-rouge">Static</code> methods are not aware of <code class="highlighter-rouge">state</code> or <code class="highlighter-rouge">props</code>, <code class="highlighter-rouge">Prototype</code> methods in the component aren’t aware of <code class="highlighter-rouge">static</code> functions.</p>

<p>Enter <code class="highlighter-rouge">class PagedData</code>. A static class in the <code class="highlighter-rouge">pagination.jsx</code> file that performs all of the computations needed (save a couple) to populate the <code class="highlighter-rouge">Pagination</code> component, and we expose it in a  <code class="highlighter-rouge">static</code> method. We can then pass in our data set, page and displayCount <code class="highlighter-rouge">state</code> and let the <code class="highlighter-rouge">Pagination</code> component take care of itself a bit more. It will also make the component reusable, without rewriting all of the functions somewhere else.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="cm">/* pagination.jsx */</span>
<span class="kr">class</span> <span class="nx">PagedData</span> <span class="p">{</span>
  <span class="nx">constructor</span><span class="p">(</span><span class="nx">d</span><span class="p">,</span> <span class="nx">o</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">r</span> <span class="o">=</span> <span class="p">{</span><span class="na">paginatedProps</span><span class="p">:{},</span> <span class="na">paginatedData</span><span class="p">:[]};</span>

    <span class="nx">r</span><span class="p">.</span><span class="nx">paginatedProps</span><span class="p">.</span><span class="nx">total</span> <span class="o">=</span> <span class="nx">d</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
    <span class="nx">r</span><span class="p">.</span><span class="nx">paginatedProps</span><span class="p">.</span><span class="nx">itemStart</span> <span class="o">=</span> <span class="nx">PagedData</span><span class="p">.</span><span class="nx">getStart</span><span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">paginatedProps</span><span class="p">.</span><span class="nx">total</span><span class="p">,</span> <span class="nx">o</span><span class="p">.</span><span class="nx">page</span><span class="p">,</span> <span class="nx">o</span><span class="p">.</span><span class="nx">displayCount</span><span class="p">);</span>
    <span class="nx">r</span><span class="p">.</span><span class="nx">paginatedProps</span><span class="p">.</span><span class="nx">itemEnd</span> <span class="o">=</span> <span class="nx">PagedData</span><span class="p">.</span><span class="nx">getEnd</span><span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">paginatedProps</span><span class="p">.</span><span class="nx">total</span><span class="p">,</span> <span class="nx">o</span><span class="p">.</span><span class="nx">page</span><span class="p">,</span> <span class="nx">o</span><span class="p">.</span><span class="nx">displayCount</span><span class="p">);</span>
    <span class="nx">r</span><span class="p">.</span><span class="nx">paginatedProps</span><span class="p">.</span><span class="nx">pageOptions</span> <span class="o">=</span> <span class="nx">PagedData</span><span class="p">.</span><span class="nx">getPageOptions</span><span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">paginatedProps</span><span class="p">.</span><span class="nx">total</span><span class="p">,</span> <span class="nx">o</span><span class="p">.</span><span class="nx">displayCount</span><span class="p">);</span>
    <span class="nx">r</span><span class="p">.</span><span class="nx">paginatedProps</span><span class="p">.</span><span class="nx">page</span> <span class="o">=</span> <span class="nx">o</span><span class="p">.</span><span class="nx">page</span><span class="p">;</span>
    <span class="nx">r</span><span class="p">.</span><span class="nx">paginatedProps</span><span class="p">.</span><span class="nx">displayCount</span> <span class="o">=</span> <span class="nx">o</span><span class="p">.</span><span class="nx">displayCount</span><span class="p">;</span>
    <span class="nx">r</span><span class="p">.</span><span class="nx">paginatedData</span> <span class="o">=</span> <span class="nx">PagedData</span><span class="p">.</span><span class="nx">splitData</span><span class="p">(</span><span class="nx">d</span><span class="p">,</span> <span class="nx">r</span><span class="p">.</span><span class="nx">paginatedProps</span><span class="p">.</span><span class="nx">itemStart</span><span class="p">,</span> <span class="nx">r</span><span class="p">.</span><span class="nx">paginatedProps</span><span class="p">.</span><span class="nx">itemEnd</span><span class="p">);</span>

    <span class="k">return</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">freeze</span><span class="p">(</span><span class="nx">r</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="kr">static</span> <span class="nx">splitData</span><span class="p">(</span><span class="nx">d</span><span class="p">,</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">d</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">s</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">e</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="kr">static</span> <span class="nx">getStart</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="nx">p</span><span class="p">,</span> <span class="nx">d</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="nx">t</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">?</span> <span class="p">((</span><span class="nx">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="nx">d</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="kr">static</span> <span class="nx">getEnd</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span> <span class="nx">p</span><span class="p">,</span> <span class="nx">d</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">h</span> <span class="o">=</span> <span class="nx">p</span> <span class="o">*</span> <span class="nx">d</span><span class="p">;</span>
    <span class="k">return</span> <span class="p">(</span><span class="nx">h</span> <span class="o">&lt;=</span> <span class="nx">c</span><span class="p">)</span> <span class="p">?</span> <span class="nx">h</span> <span class="p">:</span> <span class="nx">c</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="kr">static</span> <span class="nx">getPageOptions</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="nx">d</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">o</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Array</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">ceil</span><span class="p">(</span><span class="nx">t</span> <span class="o">/</span> <span class="nx">d</span><span class="p">));</span>
    <span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="nx">o</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
    <span class="k">while</span><span class="p">(</span><span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">a</span><span class="p">){</span>
      <span class="nx">o</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
      <span class="nx">i</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">o</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>

<p>I split up the result to help the owner do it’s job, allowing it to pass <code class="highlighter-rouge">paginatedProps</code> and <code class="highlighter-rouge">paginatedData</code> to the proper place. Our new class gets created by calling the following method with <code class="highlighter-rouge">Pagination.pageData()</code> and pass in the <code class="highlighter-rouge">data</code> array and our <code class="highlighter-rouge">state</code> object.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="cm">/* app.jsx */</span>
<span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">paginated</span> <span class="o">=</span> <span class="nx">Pagination</span><span class="p">.</span><span class="nx">pageData</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">data</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">);</span>
<span class="p">...</span>

<span class="cm">/* pagination.jsx */</span>

<span class="kr">static</span> <span class="nx">pageData</span><span class="p">(</span><span class="nx">d</span><span class="p">,</span> <span class="nx">o</span><span class="p">)</span> <span class="p">{</span>

  <span class="k">return</span> <span class="k">new</span> <span class="nx">PagedData</span><span class="p">(</span><span class="nx">d</span><span class="p">,</span><span class="nx">o</span><span class="p">);</span>

<span class="p">}</span>
</code></pre>
</div>

<p>I had to do some clean up for the values in <code class="highlighter-rouge">Pagination</code>, but that was fairly simple, and is in the new code set. One other item that needed cleaning up, is correcting the current page when the <code class="highlighter-rouge">displayCountOptions</code> change.  That gets moved to a component lifecycle method.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nx">componentWillUpdate</span><span class="p">(</span><span class="nx">nextProps</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">paginatedProps</span><span class="p">.</span><span class="nx">total</span> <span class="o">!==</span> <span class="nx">nextProps</span><span class="p">.</span><span class="nx">paginatedProps</span><span class="p">.</span><span class="nx">total</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">onChange</span><span class="p">({</span><span class="s1">'page'</span> <span class="p">:</span> <span class="mi">1</span><span class="p">});</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">nextProps</span><span class="p">.</span><span class="nx">paginatedProps</span><span class="p">.</span><span class="nx">displayCount</span> <span class="o">!==</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">paginatedProps</span><span class="p">.</span><span class="nx">displayCount</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">while</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">paginatedProps</span><span class="p">.</span><span class="nx">itemStart</span> <span class="o">&gt;</span> <span class="nx">i</span> <span class="o">*</span> <span class="nx">nextProps</span><span class="p">.</span><span class="nx">paginatedProps</span><span class="p">.</span><span class="nx">displayCount</span><span class="p">)</span> <span class="p">{</span> <span class="nx">i</span><span class="o">++</span><span class="p">;</span> <span class="p">};</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">onChange</span><span class="p">({</span><span class="s1">'page'</span> <span class="p">:</span> <span class="nx">i</span><span class="p">});</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>

<p><code class="highlighter-rouge">componentWillUpdate</code> and <code class="highlighter-rouge">componentDidUpdate</code> are pretty powerful when used correctly. I dare you to <code class="highlighter-rouge">this.setState()</code> from one of these… ok I don’t mean that. Loops are never fun - so avoid this.</p>

<p>Now to call our component, we simply need this -</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;Pagination</span>
  <span class="na">paginatedProps=</span><span class="s">{paginated.paginatedProps}</span>
  <span class="na">onChange=</span><span class="s">{this.handleData}</span>
<span class="nt">/&gt;</span>
</code></pre>
</div>

<p>###Handling the Change Events
In preparing for search, I originally modified the “handlePagination()” method, to simplify the interaction. Then I realized, the method wasn’t even required, and could be bypassed altogether.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="cm">/* app.jsx */</span>
<span class="c1">//before</span>
<span class="nx">handlePagination</span><span class="p">(</span><span class="nx">setting</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">nextState</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">assign</span><span class="p">({},</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">,</span> <span class="nx">setting</span><span class="p">);</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">nextState</span><span class="p">.</span><span class="nx">displayCount</span> <span class="o">!=</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">displayCount</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">nextState</span><span class="p">.</span><span class="nx">pageOptions</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getPageOptions</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span> <span class="nx">nextState</span><span class="p">.</span><span class="nx">displayCount</span><span class="p">);</span>

    <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="nx">nextState</span><span class="p">.</span><span class="nx">pageOptions</span><span class="p">.</span><span class="nx">every</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">option</span><span class="p">){</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">that</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">itemStart</span> <span class="o">&lt;</span> <span class="nx">option</span> <span class="o">*</span> <span class="nx">nextState</span><span class="p">.</span><span class="nx">displayCount</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">nextState</span><span class="p">.</span><span class="nx">page</span> <span class="o">=</span> <span class="nx">option</span><span class="p">;</span>
        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="p">}</span>

  <span class="nx">nextState</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">assign</span><span class="p">(</span><span class="nx">nextState</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">getStartEnd</span><span class="p">(</span><span class="nx">nextState</span><span class="p">));</span>
  <span class="nx">nextState</span><span class="p">.</span><span class="nx">data</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">paginateData</span><span class="p">(</span><span class="nx">nextState</span><span class="p">.</span><span class="nx">itemStart</span><span class="p">,</span> <span class="nx">nextState</span><span class="p">.</span><span class="nx">itemEnd</span><span class="p">);</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">(</span><span class="nx">nextState</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">//after</span>
<span class="p">...</span>
<span class="o">&lt;</span><span class="nx">Pagination</span>
  <span class="nx">paginatedProps</span><span class="o">=</span><span class="p">{</span><span class="nx">paginated</span><span class="p">.</span><span class="nx">paginatedProps</span><span class="p">}</span>
  <span class="nx">onChange</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">)}</span>
<span class="sr">/</span><span class="err">&gt;
</span>
</code></pre>
</div>

<p>Now any thing from an <code class="highlighter-rouge">onChange</code> event can be handled the same way - by performing <code class="highlighter-rouge">setState</code> which forces a refresh, calling the <code class="highlighter-rouge">PageData</code> method, and everything is up-to-date. Since my low level components and <code class="highlighter-rouge">DataGrid</code> all play well together - I don’t even need the function I originally created. Refactor #FTW!</p>

<h3 id="default-props">Default Props</h3>
<p>One last item to cover, then we can move on. When you are looking for properties in a component, you need to make sure those are set in it’s owner so those are available. However, if those aren’t included you get errors and such - and sometimes that’s actually avoidable because the property could have a default value.  React allows for <code class="highlighter-rouge">defaultProps</code> to be set up. I created those like this:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nx">DataGrid</span><span class="p">.</span><span class="nx">defaultProps</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">data</span><span class="p">:</span> <span class="p">[],</span>
  <span class="na">displayCount</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
  <span class="na">page</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="na">searchTerm</span><span class="p">:</span> <span class="s2">""</span>
<span class="p">}</span>
</code></pre>
</div>

<p>Now when I want to use this component, I can pass in <code class="highlighter-rouge">&lt;DataGrid /&gt;</code> and not blow it up. With this method, I could render the <code class="highlighter-rouge">DataGrid</code> without any data, and pass it in later. I can also pass in a page, or search term if I have one stored.  This makes our components more flexible to the end user.</p>

<h2 id="wrap-up">Wrap Up</h2>
<p>I had to. I tried to leave it - but as I got deeper into the search component, I couldn’t leave it alone. Some of this comes from a deeper understanding of functional programming, and really separating out functionality into its’ simplest forms. To be perfectly honest, I still feel like I could slim this down even more. I have drastically reduced what’s in state, and I’ve built a more modular set of components. I’ve also adhered to the top down data flow, by exposing functions in each component for it’s owner to call and pass back</p>

<p>The repo that’s been refactored also includes the search functionality, which will be in another post very soon.</p>

<p>I’ve updated my <a href="https://github.com/kellyjandrews/react-tutorial/tree/searchbar">GitHub repo</a> with the source code from this tutorial.</p>



  <h4>React Data Grid Tutorials</h4>
  <ol>
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      
      <li><a href="/2015/03/30/react-up-and-running.html" title="React - Up and Running">React - Up and Running</a></li>
      
    
  
    
      
      <li><a href="/2015/04/01/modular-react-components-with-browserify.html" title="Modular React Components With Browserify">Modular React Components With Browserify</a></li>
      
    
  
    
      
      <li><a href="/2015/04/08/data-driven-react-components.html" title="Data Driven React Components">Data Driven React Components</a></li>
      
    
  
    
  
    
      
      <li><a href="/2015/04/13/react-component-communication.html" title="React Component Communication">React Component Communication</a></li>
      
    
  
    
      
      <li class="active">Refactoring React Data Grid</li>
      
    
  
    
      
      <li><a href="/2015/04/21/data-filtering-for-react.html" title="Data Filtering for React">Data Filtering for React</a></li>
      
    
  
  </ol>



<div id="disqus_thread"></div>
   <script type="text/javascript">
       /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
       var disqus_shortname = 'kellyjandrews'; // required: replace example with your forum shortname
       var disqus_title = "Refactoring React Data Grid";
       /* * * DON'T EDIT BELOW THIS LINE * * */
       (function() {
           var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
           dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
           (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
       })();
   </script>
   <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

</div>

</div>

    </div>

    <footer class="text-center">
    <small>All content copyright <a href="/">kelly j andrews</a> &copy; 2016 &bull; All rights reserved.</small>
    </a>
</footer>

    <script>
    (function(i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r;
        i[r] = i[r] || function() {
            (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date();
        a = s.createElement(o),
            m = s.getElementsByTagName(o)[0];
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

    ga('create', 'UA-47461674-1', 'kellyjandrews.com');
    ga('send', 'pageview');
</script>
</body>

</html>
